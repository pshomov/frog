<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
    <title>Check status</title>
    <script type="text/javascript" src="../Scripts/jquery-1.4.4.js"></script>
    <script type="text/javascript" src="http://github.com/DmitryBaranovskiy/raphael/raw/master/raphael-min.js"></script>
    <script type="text/javascript" language="javascript">
        var paper;
        $(
            function() {
                paper = Raphael("tasks", 640, 400);
                setInterval("update_status()", 5000);
                update_status();
            }
        );

        function update_status() {
            $.get("../status/index", function data(msg) {
                switch (msg.status.Current) {
                    case 0: set_status("Build started", "yellow");
                        break;
                    case 1: set_status("Not started", "gray");
                        break;
                    case 2: set_status("Build complete", "red");
                        break;
                    case 3: set_status("Build complete", "green");
                        break;
                    default:
                        set_status("Unknown build status", "cyan");
                }

                var tasks = msg.status.PipelineStatus.tasks;
                update_tasks(tasks);
            });
        }
        function set_status(msg, color) {
            $("#status").text(msg);
            $("body").attr("style", "background : " + color + ";");
        }

        function update_tasks(tasks) {
            paper.clear();
            var taskStatusToColor = { 0 : "gray", 1 : "yellow", 2 : "green", 3 : "red" };
            for (var i = 0; i < tasks.length; i++) {
                var r = paper.rect(100 + (i * 100), 10, 100, 50);
                var text = paper.text(100 + (i * 100), 10, tasks[i].Name);
                text.attr("fill", "#f1f1f1");
                text.translate((100 - text.getBBox().width) / 2, (50 - text.getBBox().height) / 2);
                r.attr("fill", taskStatusToColor[tasks[i].Status]);
            }
        }
    </script>
    </head>
    <body>
        <div id="status"></div>
        <div id="tasks"></div>
    </body>
</html>